<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="description" content="Ứng dụng tính BMI chuẩn Y khoa dành cho người Châu Á">
    
    <!-- PWA iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BMI Pro">

    <title>BMI Pro - Theo Dõi Sức Khỏe</title>

    <!-- PWA Manifest Generation -->
    <link rel="manifest" id="my-manifest-placeholder">
    <script>
        // Tạo icon xanh y tế
        const iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><rect width="512" height="512" rx="120" fill="#22c55e"/><path d="M256 128c70.7 0 128 57.3 128 128 0 70.7-57.3 128-128 128-70.7 0-128-57.3-128-128 0-70.7 57.3-128 128-128zm0 40c-48.6 0-88 39.4-88 88s39.4 88 88 88 88-39.4 88-88-39.4-88-88-88z" fill="white"/><path d="M256 200v112M200 256h112" stroke="#22c55e" stroke-width="24" stroke-linecap="round"/></svg>`;
        const iconBlob = new Blob([iconSvg], {type: 'image/svg+xml'});
        const iconUrl = URL.createObjectURL(iconBlob);

        const manifest = {
            "name": "BMI Pro",
            "short_name": "BMI",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#f8fafc",
            "theme_color": "#22c55e",
            "orientation": "portrait",
            "icons": [
                { "src": iconUrl, "sizes": "512x512", "type": "image/svg+xml", "purpose": "any maskable" }
            ]
        };
        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        document.querySelector('#my-manifest-placeholder').setAttribute('href', URL.createObjectURL(blob));
    </script>
    <link id="favicon" rel="icon" type="image/svg+xml" href="">
    <script>document.getElementById('favicon').href = iconUrl;</script>

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: { sans: ['Quicksand', 'sans-serif'] },
            colors: {
              bmi: {
                blue: '#3b82f6',
                green: '#22c55e',
                yellow: '#eab308',
                orange: '#f97316',
                red: '#ef4444',
                dark: '#1e293b'
              }
            },
            animation: {
              'fade-in': 'fadeIn 0.5s ease-out',
              'slide-up': 'slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1)',
              'bounce-slight': 'bounceSlight 2s infinite',
            },
            keyframes: {
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
              slideUp: { '0%': { transform: 'translateY(40px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
              bounceSlight: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-3px)' } }
            }
          }
        }
      }
    </script>
    <style>
      body { background-color: #f8fafc; -webkit-font-smoothing: antialiased; overscroll-behavior-y: contain; }
      * { -webkit-tap-highlight-color: transparent; outline: none; }
      
      /* Range Slider Customization */
      input[type=range] {
        -webkit-appearance: none;
        width: 100%;
        background: transparent;
      }
      input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none;
        height: 24px;
        width: 24px;
        border-radius: 50%;
        background: #ffffff;
        border: 4px solid currentColor;
        cursor: pointer;
        margin-top: -10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        transition: transform 0.1s;
      }
      input[type=range]::-webkit-slider-thumb:active { transform: scale(1.2); }
      input[type=range]::-webkit-slider-runnable-track {
        width: 100%;
        height: 4px;
        cursor: pointer;
        background: #e2e8f0;
        border-radius: 2px;
      }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body class="min-h-screen bg-slate-50 py-6 px-4 font-sans text-slate-800 flex flex-col items-center">

    <div class="w-full max-w-md flex flex-col h-full">
        
        <!-- HEADER -->
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-3">
                <div class="bg-white p-2 rounded-xl shadow-sm text-green-500">
                    <i data-lucide="activity" class="w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold text-slate-800 leading-none">BMI <span class="text-green-500">Pro</span></h1>
                    <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Sức khỏe Châu Á</span>
                </div>
            </div>
            
            <div class="flex items-center gap-2">
                <!-- Nút Cài đặt (Ẩn mặc định) -->
                <button id="btn-install" class="hidden flex items-center gap-2 bg-green-50 text-green-600 px-3 py-2 rounded-full font-bold text-xs hover:bg-green-100 transition-colors">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    <span>Cài đặt</span>
                </button>
                
                <!-- Nút Chia sẻ File -->
                <button onclick="shareAppFile()" class="bg-white text-slate-500 p-2.5 rounded-full shadow-sm hover:text-green-600 hover:shadow-md transition-all active:scale-95">
                    <i data-lucide="share-2" class="w-5 h-5"></i>
                </button>
            </div>
        </header>

        <!-- INPUT CARD -->
        <div class="bg-white rounded-3xl shadow-xl shadow-slate-200/50 p-6 mb-6 border border-slate-100 relative overflow-hidden">
            <!-- Background Decoration -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-green-50 rounded-full blur-3xl -mr-16 -mt-16 opacity-50"></div>

            <div class="space-y-8 relative z-10">
                <!-- Chiều cao -->
                <div>
                    <div class="flex justify-between items-end mb-4">
                        <label class="flex items-center gap-2 text-sm font-bold text-slate-500 uppercase tracking-wider">
                            <i data-lucide="ruler" class="w-4 h-4"></i> Chiều cao
                        </label>
                        <div class="flex items-baseline gap-1 text-green-600">
                            <input type="number" id="input-height" value="165" class="w-16 text-right text-3xl font-extrabold bg-transparent border-b border-dashed border-green-200 focus:border-green-500 text-center" oninput="updateVal('height', this.value)">
                            <span class="text-sm font-bold opacity-60">cm</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="adjust('height', -1)" class="w-10 h-10 rounded-xl bg-slate-50 text-slate-400 flex items-center justify-center hover:bg-green-50 hover:text-green-500 active:scale-90 transition-all"><i data-lucide="minus" class="w-5 h-5"></i></button>
                        <input type="range" id="range-height" min="100" max="220" value="165" class="flex-1 text-green-500" oninput="updateVal('height', this.value)">
                        <button onclick="adjust('height', 1)" class="w-10 h-10 rounded-xl bg-slate-50 text-slate-400 flex items-center justify-center hover:bg-green-50 hover:text-green-500 active:scale-90 transition-all"><i data-lucide="plus" class="w-5 h-5"></i></button>
                    </div>
                </div>

                <div class="h-px bg-slate-100"></div>

                <!-- Cân nặng -->
                <div>
                    <div class="flex justify-between items-end mb-4">
                        <label class="flex items-center gap-2 text-sm font-bold text-slate-500 uppercase tracking-wider">
                            <i data-lucide="weight" class="w-4 h-4"></i> Cân nặng
                        </label>
                        <div class="flex items-baseline gap-1 text-green-600">
                            <input type="number" id="input-weight" value="60" class="w-16 text-right text-3xl font-extrabold bg-transparent border-b border-dashed border-green-200 focus:border-green-500 text-center" oninput="updateVal('weight', this.value)">
                            <span class="text-sm font-bold opacity-60">kg</span>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="adjust('weight', -1)" class="w-10 h-10 rounded-xl bg-slate-50 text-slate-400 flex items-center justify-center hover:bg-green-50 hover:text-green-500 active:scale-90 transition-all"><i data-lucide="minus" class="w-5 h-5"></i></button>
                        <input type="range" id="range-weight" min="30" max="150" value="60" class="flex-1 text-green-500" oninput="updateVal('weight', this.value)">
                        <button onclick="adjust('weight', 1)" class="w-10 h-10 rounded-xl bg-slate-50 text-slate-400 flex items-center justify-center hover:bg-green-50 hover:text-green-500 active:scale-90 transition-all"><i data-lucide="plus" class="w-5 h-5"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <!-- RESULT CARD (Live Update) -->
        <div id="result-card" class="bg-bmi-dark text-white rounded-3xl p-6 shadow-2xl shadow-slate-300 relative overflow-hidden transition-all duration-500 transform">
            <!-- Dynamic Background Gradient -->
            <div id="result-bg" class="absolute inset-0 bg-gradient-to-br from-bmi-green to-slate-900 opacity-80 transition-colors duration-500"></div>
            
            <div class="relative z-10 flex flex-col items-center text-center">
                <div class="inline-flex items-center gap-1 bg-white/10 px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider mb-2 backdrop-blur-md border border-white/10">
                    <i data-lucide="info" class="w-3 h-3"></i> Chuẩn Châu Á
                </div>
                
                <div class="flex items-baseline justify-center mb-1">
                    <span id="bmi-value" class="text-7xl font-black tracking-tighter drop-shadow-lg">22.0</span>
                </div>
                <span class="text-sm font-medium opacity-60 uppercase tracking-widest mb-6">Chỉ số BMI (kg/m²)</span>

                <div id="bmi-category" class="text-xl font-bold bg-white text-slate-900 px-6 py-3 rounded-2xl shadow-lg transition-all duration-300 min-w-[200px]">
                    Bình thường
                </div>
            </div>
        </div>

        <!-- SCALE & INFO -->
        <div class="mt-6 w-full animate-slide-up">
            <!-- Thanh thước đo -->
            <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100 mb-4">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-3">Thang đo tham chiếu</h3>
                <div class="relative h-4 w-full rounded-full overflow-hidden flex mb-2">
                    <div class="h-full bg-blue-500 flex-[3.5]"></div>
                    <div class="h-full bg-green-500 flex-[4.5]"></div>
                    <div class="h-full bg-yellow-500 flex-[2]"></div>
                    <div class="h-full bg-orange-500 flex-[5]"></div>
                    <div class="h-full bg-red-500 flex-[5]"></div>
                </div>
                <!-- Kim chỉ -->
                <div class="relative w-full h-2">
                    <div id="scale-pin" class="absolute top-0 -mt-1 w-0.5 h-4 bg-slate-800 transition-all duration-500" style="left: 20%">
                        <div class="w-3 h-3 bg-slate-800 rounded-full -ml-[5px] -mt-1 ring-2 ring-white"></div>
                    </div>
                </div>
                <div class="flex justify-between text-[10px] font-bold text-slate-400 font-mono mt-2">
                    <span>15</span>
                    <span class="pl-2">18.5</span>
                    <span class="pl-1">23</span>
                    <span>25</span>
                    <span class="pl-4">30</span>
                    <span>35</span>
                </div>
            </div>

            <!-- Lời khuyên -->
            <div class="bg-blue-50 border border-blue-100 rounded-2xl p-4 flex gap-4 items-start">
                <div class="bg-blue-100 p-2 rounded-lg text-blue-600 flex-shrink-0">
                    <i data-lucide="lightbulb" class="w-5 h-5"></i>
                </div>
                <div>
                    <h4 class="font-bold text-blue-800 text-sm mb-1 uppercase">Lời khuyên</h4>
                    <p id="advice-text" class="text-sm text-slate-600 leading-relaxed">
                        Cân nặng của bạn đang ở mức lý tưởng. Hãy duy trì chế độ ăn uống và vận động hiện tại nhé!
                    </p>
                </div>
            </div>
        </div>
        
        <div class="mt-8 text-center opacity-30">
            <p class="text-[10px] font-bold uppercase tracking-widest">© 2026 Dr. Nguyen Minh Tam</p>
        </div>

    </div>

    <!-- LOGIC -->
    <script>
        // --- 1. BIẾN & CẤU HÌNH ---
        const COLORS = {
            underweight: '#3b82f6', // Blue
            normal:      '#22c55e', // Green
            overweight:  '#eab308', // Yellow
            obese1:      '#f97316', // Orange
            obese2:      '#ef4444'  // Red
        };

        let height = 165;
        let weight = 60;

        // --- 2. HÀM TÍNH TOÁN BMI (ASIAN) ---
        function calculate() {
            const h = height / 100;
            const bmi = weight / (h * h);
            const val = parseFloat(bmi.toFixed(1));
            
            let cat = '', color = '', advice = '';
            
            if (val < 18.5) {
                cat = 'Nhẹ cân'; color = COLORS.underweight;
                advice = 'Bạn cần bổ sung thêm dinh dưỡng, tăng cường đạm và tinh bột để đạt cân nặng chuẩn.';
            } else if (val < 23) {
                cat = 'Bình thường'; color = COLORS.normal;
                advice = 'Tuyệt vời! Hãy duy trì chế độ ăn uống cân bằng và tập thể dục đều đặn.';
            } else if (val < 25) {
                cat = 'Thừa cân'; color = COLORS.overweight;
                advice = 'Bạn đang ở ngưỡng tiền béo phì. Hãy hạn chế đường, mỡ và vận động nhiều hơn.';
            } else if (val < 30) {
                cat = 'Béo phì độ I'; color = COLORS.obese1;
                advice = 'Cần thực hiện chế độ giảm cân khoa học. Tăng cường rau xanh, giảm tinh bột.';
            } else {
                cat = 'Béo phì độ II'; color = COLORS.obese2;
                advice = 'Mức độ cảnh báo! Hãy tham khảo ý kiến bác sĩ để có lộ trình giảm cân an toàn.';
            }

            updateUI(val, cat, color, advice);
        }

        function updateUI(bmi, cat, color, advice) {
            // Update Text
            document.getElementById('bmi-value').innerText = bmi;
            document.getElementById('bmi-category').innerText = cat;
            document.getElementById('advice-text').innerText = advice;
            
            // Update Colors
            document.getElementById('bmi-category').style.color = color;
            document.getElementById('result-bg').className = `absolute inset-0 bg-gradient-to-br opacity-90 transition-colors duration-500`;
            document.getElementById('result-bg').style.background = `linear-gradient(135deg, ${color}, #0f172a)`;
            
            // Sync Input Colors
            const inputTxts = document.querySelectorAll('#input-height, #input-weight');
            const ranges = document.querySelectorAll('input[type=range]');
            
            ranges.forEach(r => r.style.color = color);
            inputTxts.forEach(i => {
                i.style.color = color;
                i.style.borderColor = color + '40'; // add alpha
            });

            // Update Scale Pin
            const minScale = 15, maxScale = 35;
            const safeBmi = Math.min(Math.max(bmi, minScale), maxScale);
            const pct = ((safeBmi - minScale) / (maxScale - minScale)) * 100;
            document.getElementById('scale-pin').style.left = `${pct}%`;
        }

        // --- 3. SỰ KIỆN INPUT ---
        function updateVal(type, val) {
            val = parseInt(val);
            if (isNaN(val)) return;
            
            if (type === 'height') {
                if (val > 250) val = 250;
                height = val;
                document.getElementById('input-height').value = val;
                document.getElementById('range-height').value = val;
            } else {
                if (val > 200) val = 200;
                weight = val;
                document.getElementById('input-weight').value = val;
                document.getElementById('range-weight').value = val;
            }
            calculate();
        }

        function adjust(type, delta) {
            const current = type === 'height' ? height : weight;
            updateVal(type, current + delta);
        }

        // --- 4. CHIA SẺ FILE APK (HTML) ---
        async function shareAppFile() {
            try {
                // Lấy toàn bộ nội dung HTML hiện tại
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const file = new File([blob], 'BMI_Pro.html', { type: 'text/html' });

                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        files: [file],
                        title: 'BMI Pro',
                        text: 'Cài đặt ứng dụng BMI Pro (Mở file này bằng trình duyệt Chrome)',
                    });
                } else {
                    // Fallback link sharing
                    await navigator.share({
                        title: 'BMI Pro',
                        text: 'App tính BMI chuẩn Châu Á',
                        url: window.location.href
                    });
                }
            } catch (err) {
                console.log('Share cancelled or failed', err);
                alert('Không thể chia sẻ file trên thiết bị này.');
            }
        }

        // --- 5. PWA INSTALL ---
        let deferredPrompt;
        const installBtn = document.getElementById('btn-install');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.remove('hidden');
            installBtn.classList.add('flex'); // Show button
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    deferredPrompt = null;
                    installBtn.classList.add('hidden');
                }
            }
        });

        // Init Icons & Calc
        lucide.createIcons();
        calculate();

    </script>
</body>
</html>
