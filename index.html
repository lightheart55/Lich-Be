<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BMI Pro - Theo Dõi Sức Khỏe</title>
    
    <!-- PWA Meta Tags (Android & General) -->
    <meta name="application-name" content="BMI Pro">
    <meta name="description" content="Ứng dụng tính BMI chuẩn Y khoa dành cho người Châu Á">
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- PWA Meta Tags (iOS Specific) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BMI Pro">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Auto-generated Icons will be injected here -->
    <link id="manifest-placeholder" rel="manifest">
    <link id="apple-touch-icon" rel="apple-touch-icon" href="">
    <link rel="icon" type="image/png" id="favicon" href="">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Import Map for React modules -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.294.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "recharts": "https://esm.sh/recharts@^3.6.0"
  }
}
</script>

    <style>
        /* =========================================
           GLOBAL VARIABLES & RESET
           ========================================= */
        :root {
            --primary: #22c55e;        
            --primary-rgb: 34, 197, 94;
            --bg-body: #f8fafc;
            --text-dark: #1e293b;
            --text-gray: #64748b;
            --text-light: #94a3b8;
            --white: #ffffff;
            --card-shadow: 0 4px 20px -5px rgba(0,0,0,0.05);
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            outline: none;
            touch-action: manipulation;
        }

        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f1f5f9;
            color: var(--text-dark);
            overflow: hidden; /* Prevent body scroll, handle inside app-container */
            transition: background-color 0.5s ease;
            user-select: none;
        }

        #root {
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* =========================================
           LAYOUT STRUCTURE
           ========================================= */
        .app-container {
            width: 100%;
            height: 100%;
            max-width: 450px; /* Mobile width on desktop */
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* =========================================
           HEADER
           ========================================= */
        .header {
            padding: 24px 24px 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            background: linear-gradient(to right, rgba(255,255,255,0.8), rgba(255,255,255,0.4));
            z-index: 10;
        }

        .brand h1 {
            font-size: 26px;
            font-weight: 900;
            margin: 0;
            letter-spacing: -1px;
            color: var(--text-dark);
        }

        .brand span {
            color: var(--primary);
            transition: color 0.5s ease;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Action Button (Share/Install) */
        .btn-action {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.8);
            color: var(--text-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s, color 0.2s, background-color 0.2s;
        }
        .btn-action:active {
            transform: scale(0.9);
            color: var(--primary);
        }
        /* Style specifically for the Install button with text */
        .btn-action.install-ready {
            color: var(--primary);
            background: #ecfdf5;
            width: auto;
            padding: 0 14px;
            border-radius: 20px;
            gap: 6px;
        }
        .btn-text {
            font-size: 13px;
            font-weight: 800;
            white-space: nowrap;
        }

        .header-info {
            text-align: right;
        }

        .header-info small {
            display: block;
            font-size: 10px;
            font-weight: 800;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .header-info strong {
            display: block;
            font-size: 14px;
            font-weight: 900;
            color: var(--primary);
            text-transform: uppercase;
            line-height: 1;
            transition: color 0.5s ease;
        }

        /* =========================================
           CONTENT SCROLL AREA
           ========================================= */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px 24px 40px 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scrollbar-width: none; 
            -ms-overflow-style: none;
        }
        .content::-webkit-scrollbar { 
            display: none; 
        }

        /* =========================================
           RESULT CARD
           ========================================= */
        .result-card {
            background: #1e293b;
            border-radius: 32px;
            padding: 32px 20px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.3);
            transition: background 0.5s ease, box-shadow 0.5s ease;
            flex-shrink: 0;
        }

        .result-card::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 140%; height: 140%;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 60%);
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .citation-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            margin-bottom: 16px;
            position: relative;
            z-index: 2;
            transition: background 0.2s;
        }
        .citation-btn:active {
            background: rgba(255,255,255,0.2);
            transform: scale(0.96);
        }

        .bmi-value {
            font-size: 80px;
            font-weight: 900;
            line-height: 1;
            margin: 0;
            letter-spacing: -3px;
            position: relative;
            z-index: 2;
            text-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .bmi-unit {
            font-size: 16px;
            font-weight: 600;
            opacity: 0.8;
            margin-bottom: 24px;
            position: relative;
            z-index: 2;
        }

        .bmi-badge {
            display: inline-block;
            background: rgba(255,255,255,0.95);
            color: var(--text-dark);
            padding: 12px 32px;
            border-radius: 18px;
            font-size: 18px;
            font-weight: 800;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            position: relative;
            z-index: 2;
            transition: color 0.5s ease;
        }

        /* =========================================
           INPUT CARDS
           ========================================= */
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .card {
            background: #fff;
            border-radius: 24px;
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: 0 4px 20px -5px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, border-color 0.5s ease, background 0.5s ease;
        }
        .card:active {
            transform: scale(0.99);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-label {
            font-size: 12px;
            font-weight: 800;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-value {
            display: flex;
            align-items: baseline;
            gap: 4px;
        }

        .val-input {
            border: none;
            background: transparent;
            font-size: 32px;
            font-weight: 900;
            color: var(--primary);
            width: 80px;
            text-align: right;
            padding: 0;
            margin: 0;
            transition: color 0.5s ease;
            font-family: inherit;
        }
        
        .val-unit {
            font-size: 14px;
            font-weight: 700;
            color: #cbd5e1;
        }

        .control-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .btn-circle {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-gray);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.03);
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .btn-circle:active {
            background-color: var(--bg-body);
            transform: scale(0.92);
            color: var(--primary);
            border-color: var(--primary);
        }
        .btn-circle svg {
            width: 20px;
            height: 20px;
            stroke-width: 3px;
        }

        .slider-container {
            flex: 1;
            height: 30px;
            display: flex;
            align-items: center;
        }

        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            outline: none;
            transition: background 0.1s;
            cursor: pointer;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #ffffff;
            border: 6px solid var(--primary);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            margin-top: 0;
            transition: transform 0.1s, border-color 0.5s ease;
        }
        input[type=range]::-webkit-slider-thumb:active {
            transform: scale(1.15);
        }

        /* =========================================
           SCALE VISUALIZER
           ========================================= */
        .scale-container {
            margin-top: 10px;
        }

        .scale-bar {
            display: flex;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 12px;
            opacity: 0.9;
        }
        .seg { height: 100%; }
        .bg-blue { background-color: #3b82f6; flex: 3.5; }
        .bg-green { background-color: #22c55e; flex: 4.5; }
        .bg-yellow { background-color: #eab308; flex: 2; }
        .bg-orange { background-color: #f97316; flex: 5; }
        .bg-red { background-color: #ef4444; flex: 5; }

        .pin-area {
            position: relative;
            height: 20px;
            width: 100%;
        }

        .pin {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: left 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .pin-head {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: var(--primary);
            border: 3px solid #fff;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: background-color 0.5s ease;
            z-index: 2;
        }

        .pin-line {
            width: 2px;
            height: 12px;
            background-color: var(--primary);
            opacity: 1;
            margin-top: -2px;
            border-radius: 2px;
            transition: background-color 0.5s ease;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            font-family: monospace;
            font-weight: 700;
            color: var(--text-light);
            margin-top: 4px;
            padding: 0 2px;
        }

        /* =========================================
           FOOTER & MODAL
           ========================================= */
        .footer {
            text-align: center;
            padding: 10px 0;
        }
        .footer p {
            font-size: 10px;
            font-weight: 800;
            color: #cbd5e1;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            margin: 0;
        }

        .modal-overlay {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 24px;
            animation: fadeIn 0.2s ease-out;
        }
        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: #fff;
            width: 100%;
            max-width: 350px;
            border-radius: 28px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            position: relative;
            animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .btn-close {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #f1f5f9;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-gray);
            cursor: pointer;
        }

        .modal-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 20px;
            transition: color 0.5s ease;
        }

        .modal-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .modal-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px dashed #e2e8f0;
            font-size: 13px;
            color: var(--text-dark);
        }
        .modal-item strong {
            font-weight: 800;
        }

        .citation-text {
            margin-top: 20px;
            background: #f8fafc;
            padding: 12px;
            border-radius: 12px;
            font-size: 11px;
            color: var(--text-light);
            font-style: italic;
            line-height: 1.5;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- MAIN APP LOGIC (JSX/REACT) -->
    <script type="text/babel" data-type="module">
        import React, { useState, useMemo, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Info, Activity, X, Share2, Download, Minus, Plus } from 'lucide-react';

        // --- CONSTANTS & HELPERS ---
        const INITIAL_HEIGHT = 165;
        const INITIAL_WEIGHT = 60;
        const CITATION_TEXT = "Nguồn: The Asia-Pacific perspective: redefining obesity and its treatment. Health Communications Australia Pty Ltd on behalf of the Steering Committee. Sydney. 2000.";

        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        const calculateAsianBmi = (weightKg, heightCm) => {
            const heightM = heightCm / 100;
            const bmi = weightKg / (heightM * heightM);
            const roundedBmi = parseFloat(bmi.toFixed(1));

            let category = '';
            let color = '';

            // Asian standards (IDI & WPRO)
            if (roundedBmi < 18.5) {
                category = 'Nhẹ cân';
                color = '#3b82f6'; // Blue
            } else if (roundedBmi < 23) {
                category = 'Bình thường';
                color = '#22c55e'; // Green
            } else if (roundedBmi < 25) {
                category = 'Thừa cân';
                color = '#eab308'; // Yellow
            } else if (roundedBmi < 30) {
                category = 'Béo phì độ I';
                color = '#f97316'; // Orange
            } else {
                category = 'Béo phì độ II';
                color = '#ef4444'; // Red
            }

            return { bmi: roundedBmi, category, color };
        };

        // --- COMPONENTS ---

        // 1. InputCard Component
        const InputCard = ({ label, value, unit, min, max, onChange, activeColor }) => {
            const handleInputChange = (e) => {
                let val = parseInt(e.target.value);
                if (isNaN(val)) return; 
                if (val > 999) val = 999;
                onChange(val);
            };

            const handleBlur = () => {
                let finalVal = value;
                if (finalVal < min) finalVal = min;
                if (finalVal > max) finalVal = max;
                if (finalVal !== value) onChange(finalVal);
            }

            const percentage = ((value - min) / (max - min)) * 100;
            const cardStyle = {
                background: `linear-gradient(145deg, #ffffff 40%, ${hexToRgba(activeColor, 0.08)} 100%)`,
                borderColor: hexToRgba(activeColor, 0.2),
                boxShadow: `0 4px 20px -5px ${hexToRgba(activeColor, 0.15)}`
            };
            const sliderStyle = {
                background: `linear-gradient(to right, ${activeColor} 0%, ${activeColor} ${percentage}%, #e2e8f0 ${percentage}%, #e2e8f0 100%)`
            };

            return (
                <div className="card" style={cardStyle}>
                    <div className="card-header">
                        <span className="card-label">{label}</span>
                        <div className="card-value">
                            <input 
                                type="number" 
                                className="val-input"
                                value={value} 
                                onChange={handleInputChange} 
                                onBlur={handleBlur}
                                style={{ color: activeColor }}
                            />
                            <span className="val-unit">{unit}</span>
                        </div>
                    </div>

                    <div className="control-row">
                        <button className="btn-circle" onClick={() => onChange(Math.max(min, value - 1))}>
                            <Minus size={20} strokeWidth={3} />
                        </button>
                        <div className="slider-container">
                            <input
                                type="range"
                                min={min}
                                max={max}
                                value={value}
                                onChange={(e) => onChange(Number(e.target.value))}
                                style={sliderStyle}
                            />
                        </div>
                        <button className="btn-circle" onClick={() => onChange(Math.min(max, value + 1))}>
                            <Plus size={20} strokeWidth={3} />
                        </button>
                    </div>
                </div>
            );
        };

        // 2. BmiScale Component
        const BmiScale = ({ bmi, activeColor = '#22c55e' }) => {
            const minScale = 15;
            const maxScale = 35;
            const safeBmi = Math.min(Math.max(bmi, minScale), maxScale);
            const positionPercent = ((safeBmi - minScale) / (maxScale - minScale)) * 100;

            const cardStyle = {
                background: `linear-gradient(145deg, #ffffff 40%, ${hexToRgba(activeColor, 0.08)} 100%)`,
                borderColor: hexToRgba(activeColor, 0.2),
                boxShadow: `0 4px 20px -5px ${hexToRgba(activeColor, 0.15)}`
            };

            return (
                <div className="card scale-container" style={cardStyle}>
                    <div className="card-header" style={{ marginBottom: 10 }}>
                        <span className="card-label">Thang đo tham chiếu</span>
                    </div>
                    <div className="scale-bar">
                        <div className="seg bg-blue"></div>
                        <div className="seg bg-green"></div>
                        <div className="seg bg-yellow"></div>
                        <div className="seg bg-orange"></div>
                        <div className="seg bg-red"></div>
                    </div>
                    <div className="pin-area">
                        <div className="pin" style={{ left: `${positionPercent}%` }}>
                            <div className="pin-head" style={{ backgroundColor: activeColor }}></div>
                            <div className="pin-line" style={{ backgroundColor: activeColor }}></div>
                        </div>
                    </div>
                    <div className="scale-labels">
                        <span>15</span>
                        <span style={{ marginLeft: 20 }}>18.5</span>
                        <span style={{ marginLeft: 15 }}>23</span>
                        <span>25</span>
                        <span style={{ marginLeft: 30 }}>30</span>
                        <span>35+</span>
                    </div>
                </div>
            );
        };

        // 3. Main App Component
        const App = () => {
            const [height, setHeight] = useState(INITIAL_HEIGHT);
            const [weight, setWeight] = useState(INITIAL_WEIGHT);
            const [showCitation, setShowCitation] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);

            useEffect(() => {
                const handler = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);

            const handleInstallClick = async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        setDeferredPrompt(null);
                    }
                }
            };

            const result = useMemo(() => {
                return calculateAsianBmi(weight, height);
            }, [weight, height]);

            useEffect(() => {
                document.documentElement.style.setProperty('--primary', result.color);
                document.body.style.backgroundColor = hexToRgba(result.color, 0.05);
            }, [result.color]);

            // UPDATED: Share logic to share the HTML FILE itself
            const handleShare = async () => {
                // 1. Create a file from current DOM
                const blob = new Blob([document.documentElement.outerHTML], { type: 'text/html' });
                const file = new File([blob], 'BMI_App.html', { type: 'text/html' });
                
                // 2. Try to share the file
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'BMI Pro',
                            text: 'Cài đặt ứng dụng BMI Pro (Mở file này bằng trình duyệt Chrome)',
                        });
                        return; // Success, exit
                    } catch (err) {
                        // User cancelled or failed
                        console.log('File share failed, falling back to URL');
                    }
                }
                
                // 3. Fallback to standard URL share
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'BMI Pro',
                            text: 'Kiểm tra chỉ số BMI chuẩn Châu Á ngay trên điện thoại!',
                            url: window.location.href,
                        });
                    } catch (e) {}
                } else {
                    alert('Trình duyệt không hỗ trợ chia sẻ.');
                }
            };

            return (
                <div className="app-container">
                    {/* HEADER */}
                    <header className="header">
                        <div className="brand">
                            <h1>BMI <span>Pro</span></h1>
                        </div>
                        <div className="header-actions">
                            {deferredPrompt && (
                                <button className="btn-action install-ready" onClick={handleInstallClick} title="Cài đặt App">
                                    <Download size={18} strokeWidth={2.5} />
                                    <span className="btn-text">Cài đặt</span>
                                </button>
                            )}
                            <button className="btn-action" onClick={handleShare} title="Chia sẻ file App">
                                <Share2 size={18} />
                            </button>
                            <div className="header-info">
                                <small>Theo dõi</small>
                                <strong>Sức Khỏe</strong>
                            </div>
                        </div>
                    </header>

                    {/* CONTENT */}
                    <div className="content">
                        <div className="result-card" style={{ 
                            background: `linear-gradient(135deg, ${result.color} 0%, #0f172a 100%)`, 
                            boxShadow: `0 20px 40px -10px ${hexToRgba(result.color, 0.4)}`
                        }}>
                            <button className="citation-btn" onClick={() => setShowCitation(true)}>
                                <Activity size={14} style={{ marginRight: 4 }} />
                                Chuẩn WHO Châu Á
                                <Info size={12} style={{ marginLeft: 4, opacity: 0.8 }} />
                            </button>
                            <div className="bmi-value">{result.bmi}</div>
                            <div className="bmi-unit">kg/m²</div>
                            <div className="bmi-badge" style={{ color: result.color }}>
                                {result.category}
                            </div>
                        </div>

                        <div className="input-group">
                            <InputCard 
                                label="Chiều cao" 
                                value={height} 
                                unit="cm" 
                                min={100} max={220} 
                                onChange={setHeight}
                                activeColor={result.color}
                            />
                            <InputCard 
                                label="Cân nặng" 
                                value={weight} 
                                unit="kg" 
                                min={30} max={150} 
                                onChange={setWeight}
                                activeColor={result.color}
                            />
                        </div>

                        <BmiScale bmi={result.bmi} activeColor={result.color} />

                        <div className="footer">
                            <p>Developed by Dr. Nguyen Minh Tam © 2026</p>
                        </div>
                    </div>

                    {/* MODAL */}
                    <div className={`modal-overlay ${showCitation ? 'active' : ''}`} onClick={() => setShowCitation(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                            <button className="btn-close" onClick={() => setShowCitation(false)}>
                                <X size={20} />
                            </button>
                            <div className="modal-title" style={{ color: result.color }}>
                                <Info size={24} strokeWidth={2.5} />
                                Tiêu chuẩn Y khoa
                            </div>
                            <ul className="modal-list">
                                <li className="modal-item"><span>Nhẹ cân</span> <strong style={{color:'#3b82f6'}}>&lt; 18.5</strong></li>
                                <li className="modal-item"><span>Bình thường</span> <strong style={{color:'#22c55e'}}>18.5 - 22.9</strong></li>
                                <li className="modal-item"><span>Thừa cân</span> <strong style={{color:'#eab308'}}>23 - 24.9</strong></li>
                                <li className="modal-item"><span>Béo phì độ I</span> <strong style={{color:'#f97316'}}>25 - 29.9</strong></li>
                                <li className="modal-item"><span>Béo phì độ II</span> <strong style={{color:'#ef4444'}}>&ge; 30</strong></li>
                            </ul>
                            <div className="citation-text">
                                {CITATION_TEXT}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MOUNT ---
        const rootElement = document.getElementById('root');
        const root = createRoot(rootElement);
        root.render(<App />);
    </script>

    <!-- PWA & ICON LOGIC -->
    <script>
        (function setupPWA() {
            // 1. Icon Generator (Medical Cross Green)
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512"><rect width="512" height="512" rx="120" fill="#22c55e"/><path d="M256 128c70.7 0 128 57.3 128 128 0 70.7-57.3 128-128 128-70.7 0-128-57.3-128-128 0-70.7 57.3-128 128-128zm0 40c-48.6 0-88 39.4-88 88s39.4 88 88 88 88-39.4 88-88-39.4-88-88-88z" fill="white"/><path d="M256 200v112M200 256h112" stroke="#22c55e" stroke-width="24" stroke-linecap="round"/></svg>`;
            const iconBlob = new Blob([svg], {type: 'image/svg+xml'});
            const reader = new FileReader();
            
            reader.onloadend = () => {
                const iconUrl = reader.result;
                document.getElementById('favicon').href = iconUrl;
                document.getElementById('apple-touch-icon').href = iconUrl;
                
                // 2. Manifest Generator
                const manifest = {
                    "id": "/?source=pwa",
                    "name": "BMI Pro",
                    "short_name": "BMI",
                    "start_url": ".",
                    "display": "standalone",
                    "background_color": "#ffffff",
                    "theme_color": "#ffffff",
                    "orientation": "portrait",
                    "scope": "/",
                    "categories": ["medical", "health"],
                    "icons": [
                        { "src": iconUrl, "sizes": "512x512", "type": "image/svg+xml", "purpose": "any maskable" }
                    ],
                    "shortcuts": [
                        {
                            "name": "Tính BMI",
                            "short_name": "Tính",
                            "description": "Tính nhanh chỉ số BMI",
                            "url": "/?action=calc",
                            "icons": [{ "src": iconUrl, "sizes": "192x192" }]
                        }
                    ]
                };
                const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
                document.getElementById('manifest-placeholder').href = URL.createObjectURL(manifestBlob);
            };
            reader.readAsDataURL(iconBlob);

            // 3. Service Worker Injection
            if ('serviceWorker' in navigator) {
                const swCode = `
                    self.addEventListener('install', (e) => self.skipWaiting());
                    self.addEventListener('activate', (e) => self.clients.claim());
                    self.addEventListener('fetch', (e) => {});
                `;
                const swBlob = new Blob([swCode], {type: 'application/javascript'});
                const swUrl = URL.createObjectURL(swBlob);
                navigator.serviceWorker.register(swUrl)
                    .then(() => console.log('SW Registered'))
                    .catch(err => console.log('SW Fail', err));
            }
        })();
    </script>
</body>
</html>
